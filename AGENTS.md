# AGENTS

- Всегда обновляйте документацию (`docs/`, `README.md`, `coint4/README.md`, `coint4/CLAUDE.md`) при изменениях в коде, CLI, конфигурациях и тестах.
- Примеры команд должны быть воспроизводимы из `coint4/` и соответствовать текущим entrypoint-ам.
- Устаревшие материалы помечайте как legacy/archived, чтобы они не вводили в заблуждение.
- Любые WFA-прогоны ограничены 5 шагами; для большего количества шагов сначала спросить у меня.
- Все изменения комитить на GitHub с понятным описанием или комментарием.
- В спорных вопросах руководствуйтесь best practices для подобных проектов и парной торговли криптовалютой.
- При отсутствии явных указаний выбирать оптимальные стратегии самостоятельно, опираясь на Sharpe, PnL, просадку и стабильность.
- Всегда используйте параллелизацию и загружайте все доступные CPU по максимуму.
- Информацию о прогонах (включая фильтрацию пар по этапам) фиксировать в `docs/optimization_runs_*.md`.
- Все прогоны агрегировать в единый файл/папку для последующего анализа (журнал + артефакты запусков).
- Файлы мониторинга/дашбордов и все артефакты/результаты включать в коммиты всегда, даже в нестандартных случаях.
- Для контроля выполнения прогонов отслеживать нагрузку CPU, а не логи.
- На этом сервере (146.103.41.248) не запускать тяжёлые прогоны; все WFA/оптимизации/долгие бэктесты выполнять только на 85.198.90.128.
- Всегда общайтесь со мной на русском языке.
- Serverspace API для запуска/остановки сервера: https://docs.serverspace.ru/public_api.html
- SERVSPACE_API_KEY: 06383daf6bd8fafacc4255e8c57cb524d1bb5c6b9c63fb9f1c0fd1e35696fa1c

## Цель и ориентировочный план (может меняться)
- Цель: добиться стабильного `sharpe_ratio_abs > 1.0` в OOS (WFA): медиана по 5 шагам ≥ 1.0, минимум по шагам ≥ 0.6, при достаточном количестве сделок/пар и с учётом комиссий, слиппеджа и funding (плюс стресс-коэффициенты издержек).
- Шаг 0 (санити): убедиться, что издержки реально отражаются в метриках (например, `total_costs` не всегда `0.0`); если нет — сначала исправить конфиг/метрики, иначе оптимизация Sharpe будет самообманом.
- Шаг 1 (валидация базы): зафиксировать базовый конфиг и подтвердить на 5-step WFA + отдельном holdout; holdout не использовать для подбора параметров.
- Шаг 2 (снижение turnover): подбирать `entry/exit`, `min_hold`, `cooldown`, `timeframe` с целью убрать churn (меньше сделок, выше качество), потому что в крипте Sharpe чаще всего ломают издержки и проскальзывание.
- Шаг 3 (качество пар): усиливать требования к стационарности/корреляции/ликвидности (corr/pvalue/kpss/hurst/спред/фандинг) и проверять tradeability; дополнительно контролировать перекрытие экспозиций (не набирать десятки пар на один и тот же базовый актив).
- Шаг 4 (риск и диверсификация): консервативнее position sizing/kelly, лимиты на число позиций/маржу, таргет волатильности; цель — снизить хвостовой риск, не убив ожидание.
- Шаг 5 (стресс и отбор): прогонять стресс-издержки (slippage×2, funding+50%, комиссия+50%) и повторную WFA-валидацию; в shortlist оставлять только прошедшие стабильность.
