#!/bin/bash
# Development tests - —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –±—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã

set -e

echo "‚ö° DEVELOPMENT TESTS"
echo "==================="
echo "–¶–µ–ª—å: –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ –≤—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏"
echo "–§–æ–∫—É—Å: –ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–µ—É–¥–∞—á–Ω—ã–µ —Ç–µ—Å—Ç—ã + –±—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã"
echo ""

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd "$(dirname "$0")/.."

# –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å–∫–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–µ—É–¥–∞—á–Ω—ã–µ —Ç–µ—Å—Ç—ã
echo "1Ô∏è‚É£ –ó–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –Ω–µ—É–¥–∞—á–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤..."
if pytest --lf -x -q --tb=short; then
    echo "‚úÖ –í—Å–µ —Ä–∞–Ω–µ–µ –Ω–µ—É–¥–∞—á–Ω—ã–µ —Ç–µ—Å—Ç—ã —Ç–µ–ø–µ—Ä—å –ø—Ä–æ—Ö–æ–¥—è—Ç"
else
    echo "‚ùå –ï—Å—Ç—å –Ω–µ—É–¥–∞—á–Ω—ã–µ —Ç–µ—Å—Ç—ã - –∏—Å–ø—Ä–∞–≤—å—Ç–µ –∏—Ö –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º"
    exit 1
fi
echo ""

# –ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
echo "2Ô∏è‚É£ –ó–∞–ø—É—Å–∫ –±—ã—Å—Ç—Ä—ã—Ö —Ç–µ—Å—Ç–æ–≤..."
time pytest -n auto -m "fast and not serial and not slow" --maxfail=3 -q --tb=short
echo "‚úÖ –ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã"
echo ""

# Smoke —Ç–µ—Å—Ç—ã –¥–ª—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
echo "3Ô∏è‚É£ –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ smoke —Ç–µ—Å—Ç–æ–≤..."
pytest -m smoke --maxfail=1 -q --tb=short
echo "‚úÖ Smoke —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã"
echo ""

echo "üéØ DEVELOPMENT TESTS –ó–ê–í–ï–†–®–ï–ù–´!"
echo "–ö–æ–¥ –≥–æ—Ç–æ–≤ –¥–ª—è –∫–æ–º–º–∏—Ç–∞."
