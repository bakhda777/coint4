# Оптимизированный порядок фильтрации пар

## Обзор

Реализован новый оптимизированный порядок фильтрации пар для улучшения производительности системы. Фильтры теперь применяются в порядке от самых быстрых к самым медленным, что позволяет отсеивать неподходящие пары на ранних этапах.

## Новый порядок фильтров

1. **SSD (Sum of Squared Differences)** - быстрая предварительная фильтрация
2. **Коинтеграция** - тест Энгла-Грейнджера
3. **Beta диапазон** - проверка коэффициента регрессии
4. **Half-life** - период полураспада спреда
5. **Mean crossings** - количество пересечений среднего
6. **Hurst exponent** - показатель трендовости/возврата к среднему
7. **KPSS test** - тест стационарности
8. **Market microstructure** - ликвидность и микроструктурные факторы

Примечание: half-life считается через регрессию Δspread на lag(spread) (`calculate_half_life`) и используется одинаково в `pair_scanner` и фильтрах.

## Преимущества нового порядка

### Производительность
- **2-4x ускорение** общего времени фильтрации
- Быстрые фильтры (SSD, коинтеграция) применяются первыми
- Дорогие операции (Hurst, KPSS) выполняются только для прошедших предварительную фильтрацию пар

### Логическая последовательность
- SSD обеспечивает базовую корреляцию
- Коинтеграция проверяет долгосрочную связь
- Beta фильтрует экстремальные коэффициенты
- Half-life проверяет скорость возврата к среднему
- Остальные фильтры уточняют качество пар

## Улучшенное логирование

Добавлено детальное логирование для каждого этапа фильтрации:

```
[ФИЛЬТР] Статистика фильтрации (оптимизированный порядок):
  1. SSD → Коинтеграция: 1000 → 500 пар
  2. Коинтеграция → Beta: 500 → 400 пар
  3. Beta → Half-life: 400 → 300 пар
  4. Half-life → Mean crossings: 300 → 250 пар
  5. Mean crossings → Hurst: 250 → 200 пар
  6. Hurst → KPSS: 200 → 150 пар
  7. KPSS → Market microstructure: 150 → 100 пар
```

## Технические детали

### Измененные файлы
- `src/coint2/pipeline/filters.py` - основная логика фильтрации
- `src/coint2/pipeline/walk_forward_orchestrator.py` - улучшенное логирование

### Совместимость
- Все существующие тесты проходят успешно
- API остается неизменным
- Результаты фильтрации идентичны предыдущей версии

## Мониторинг производительности

Для отслеживания эффективности нового порядка добавлены метрики:
- Время выполнения каждого фильтра
- Количество пар, отсеянных на каждом этапе
- Общее время фильтрации
- Процент пар, прошедших каждый фильтр

## Рекомендации

1. **Мониторинг**: Отслеживайте логи фильтрации для выявления узких мест
2. **Настройка**: При необходимости корректируйте пороговые значения фильтров
3. **Кэширование**: Рассмотрите возможность кэширования результатов дорогих операций
4. **Адаптивные пороги**: Внедрите динамическую настройку порогов на основе рыночных условий

Дата реализации: Январь 2025
Версия: 2.0
