# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞

## –û–±–∑–æ—Ä

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–æ–µ–∫—Ç —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ `data_downloaded/` (`data_dir` –≤ `configs/main_2024.yaml`).
–ü—É—Ç–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞—é—Ç `cd coint4`; –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∞—è –ø–∞–ø–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç –∫–æ—Ä–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è ‚Äî `coint4/data_downloaded`.
–í —Ä–∞–±–æ—á–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –¥–≤–µ —Å—Ö–µ–º—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è:

1. **–ü–æ–º–µ—Å—è—á–Ω–∞—è (–∫–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è, –∞–∫—Ç—É–∞–ª—å–Ω–∞—è)** ‚Äî `year=YYYY/month=MM/data_part_MM.parquet`.
   –û–¥–∏–Ω parquet-—Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ —Å–∏–º–≤–æ–ª—ã –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–µ—Å—è—Ü.
2. **Legacy per-symbol/day (–∞—Ä—Ö–∏–≤)** ‚Äî `SYMBOL/year=YYYY/month=MM/day=DD/*.parquet`.
   –û–ø–∏—Å–∞–Ω–∞ –Ω–∏–∂–µ –∫–∞–∫ —É—Å—Ç–∞—Ä–µ–≤—à–∞—è, —á—Ç–æ–±—ã –Ω–µ –≤–≤–æ–¥–∏—Ç—å –≤ –∑–∞–±–ª—É–∂–¥–µ–Ω–∏–µ.

DataLoader –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç legacy per-symbol layout, –µ—Å–ª–∏ –≤ `data_downloaded/` –µ—Å—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `symbol=...`.

–ï—Å–ª–∏ —Ä—è–¥–æ–º –µ—Å—Ç—å `data_optimized/`, –∑–∞–≥—Ä—É–∑—á–∏–∫ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç –µ–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
–û–±—ã—á–Ω–æ —ç—Ç–æ —Ç–∞ –∂–µ –ø–æ–º–µ—Å—è—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –≤—ã–Ω–µ—Å–µ–Ω–Ω–∞—è –æ—Ç–¥–µ–ª—å–Ω–æ.

## –ú–∞–Ω–∏—Ñ–µ—Å—Ç –¥–∞–Ω–Ω—ã—Ö (—Ñ–∞–∫—Ç)

- –ü–µ—Ä–∏–æ–¥ –ø–æ–∫—Ä—ã—Ç–∏—è: `2021-12-31 21:15:00` ‚Üí `2025-06-30 21:00:00` (UTC, –ø–æ `timestamp`).
- –ß–∞—Å—Ç–æ—Ç–∞: 15 –º–∏–Ω—É—Ç (96 –±–∞—Ä–æ–≤ –≤ —Å—É—Ç–∫–∏).
- –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤: 650 (–ø–æ –≤—Å–µ–º monthly —Ñ–∞–π–ª–∞–º).
- –§–∞–π–ª–æ–≤: 43 monthly‚Äë—Ñ–∞–π–ª–∞ `data_part_MM.parquet`.

## Data QA (–æ—Ç—á–µ—Ç—ã)

- –û–±—â–∞—è monthly‚Äë–≤–∞–ª–∏–¥–∞—Ü–∏—è: `coint4/outputs/data_quality_report.csv`.
- –¢–æ—á–µ—á–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –ø–æ —Å–∏–º–≤–æ–ª–∞–º: `coint4/outputs/data_quality_report_BTCUSDT.csv`, `coint4/outputs/data_quality_report_ETHUSDT.csv`, `coint4/outputs/data_quality_report_BNBUSDT.csv`.

## –ü—Ä–∞–≤–∏–ª–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö

- **–ò–Ω—Ç–µ—Ä–≤–∞–ª –±–∞—Ä–æ–≤:** 15 –º–∏–Ω—É—Ç (`pair_selection.bar_minutes`), –æ–∂–∏–¥–∞–Ω–∏–µ 96 –±–∞—Ä–æ–≤ –≤ —Å—É—Ç–∫–∏.
- **–°—Ö–µ–º–∞:** –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è `timestamp`, `symbol`, `open`, `high`, `low`, `close`, `volume`, `ts_ms`.
- **–î—É–±–ª–∏–∫–∞—Ç—ã:** 0 –ø–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ `timestamp` + `symbol`; –ª—é–±—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã —Å—á–∏—Ç–∞—é—Ç—Å—è –æ—à–∏–±–∫–æ–π.
- **–ü—Ä–æ–ø—É—Å–∫–∏ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏:** –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–æ–ª—è –¥–∞–Ω–Ω—ã—Ö –≤ train ‚â• `data_processing.min_history_ratio` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.8).
- **–ì—ç–ø‚Äë–ª–∏–º–∏—Ç:** –¥–æ–ø—É—Å–∫–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–æ–ø—É—Å–∫–∏ (–ª–∏–º–∏—Ç = `fill_limit_pct` –æ—Ç —Å—É—Ç–æ—á–Ω–æ–π —Å–µ—Ç–∫–∏, capped 1‚Äì5 –±–∞—Ä–æ–≤).
- **–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ:** —Ç–æ–ª—å–∫–æ `ffill` –≤–Ω—É—Ç—Ä–∏ —Å–µ—Å—Å–∏–∏, –±–µ–∑ `bfill` –∏ –±–µ–∑ –ø–µ—Ä–µ–Ω–æ—Å–∞ —á–µ—Ä–µ–∑ –≥—Ä–∞–Ω–∏—Ü—ã —Å–µ—Å—Å–∏–π.
- **–ù–µ–ø–æ–ª–Ω—ã–µ –º–µ—Å—è—Ü—ã:** –∏—Å–∫–ª—é—á–∞–π—Ç–µ –∏–∑ –∞–Ω–∞–ª–∏–∑–∞ —á–µ—Ä–µ–∑ `end_date`/`start_date` –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç.
- **Clean window –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Å–∏–º–≤–æ–ª–æ–≤:** —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –≤ `data_filters.clean_window` –∏ `data_filters.exclude_symbols` (—Å–º. `configs/main_2024.yaml`, `configs/data_window_clean.yaml`).

–ü–æ –ø–æ—Å–ª–µ–¥–Ω–∏–º –æ—Ç—á–µ—Ç–∞–º –µ—Å—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ gap –≤ `2022-02` (BTC/ETH), –Ω–µ–ø–æ–ª–Ω—ã–π –º–µ—Å—è—Ü `2025-07`,
–∞ —Ç–∞–∫–∂–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –º–µ—Å—è—Ü—ã `2022-01/02` –¥–ª—è `BNBUSDT` ‚Äî —Å–º. –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ CSV‚Äë–æ—Ç—á–µ—Ç—ã –≤ `coint4/outputs/`.
–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ ¬´—á–∏—Å—Ç–æ–µ¬ª –æ–∫–Ω–æ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞: `2022-03-01` ‚Üí `2025-06-30` (–∏—Å–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –º–µ—Å—è—Ü—ã –∏ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–æ –≤ `data_filters`).

## üìÅ –ü–æ–º–µ—Å—è—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è)

```
data_downloaded/
‚îú‚îÄ‚îÄ year=2022/
‚îÇ   ‚îî‚îÄ‚îÄ month=01/
‚îÇ       ‚îî‚îÄ‚îÄ data_part_01.parquet
‚îú‚îÄ‚îÄ year=2023/
‚îÇ   ‚îî‚îÄ‚îÄ month=12/
‚îÇ       ‚îî‚îÄ‚îÄ data_part_12.parquet
‚îî‚îÄ‚îÄ year=2025/
    ‚îî‚îÄ‚îÄ month=07/
        ‚îî‚îÄ‚îÄ data_part_07.parquet
```

–ü—Ä–∏–Ω—Ü–∏–ø—ã:
- **Hive-style –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: `year=YYYY/month=MM/`
- **–û–¥–∏–Ω —Ñ–∞–π–ª –Ω–∞ –º–µ—Å—è—Ü**: –≤—Å–µ —Å–∏–º–≤–æ–ª—ã –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ parquet-—Ñ–∞–π–ª–∞
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å–∏–º–≤–æ–ª–∞–º**: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–æ–ª–±–µ—Ü `symbol`

## üìä –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö –≤ parquet —Ñ–∞–π–ª–∞—Ö

| –°—Ç–æ–ª–±–µ—Ü | –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|---------|------------|----------|--------|
| `timestamp` | int64 | –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö UTC | 1733011200000 |
| `symbol` | string | –°–∏–º–≤–æ–ª —Ç–æ—Ä–≥–æ–≤–æ–π –ø–∞—Ä—ã | "BTCUSDT" |
| `open` | float64 | –¶–µ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –∑–∞ 15-–º–∏–Ω—É—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥ | 96484.0 |
| `high` | float64 | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥ | 96687.8 |
| `low` | float64 | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥ | 96412.5 |
| `close` | float64 | –¶–µ–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –∑–∞ –ø–µ—Ä–∏–æ–¥ | 96633.1 |
| `volume` | float64 | –û–±—ä–µ–º —Ç–æ—Ä–≥–æ–≤ –∑–∞ –ø–µ—Ä–∏–æ–¥ | 362.012 |
| `turnover` | string | –û–±–æ—Ä–æ—Ç (–∫–∞–∫ –ø—Ä–∏—Ö–æ–¥–∏—Ç –∏–∑ API) | "12345.67" |
| `ts_ms` | int64 | –î—É–±–ª–∏—Ä—É–µ—Ç timestamp (–∏–∑–±—ã—Ç–æ—á–Ω—ã–π) | 1733011200000 |

## üîß –†–∞–±–æ—Ç–∞ —Å –ø–æ–º–µ—Å—è—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

### –ó–∞–≥—Ä—É–∑–∫–∞ –æ–¥–Ω–æ–≥–æ –º–µ—Å—è—Ü–∞:
```python
import pandas as pd

# –í—Å–µ —Å–∏–º–≤–æ–ª—ã –∑–∞ –º–µ—Å—è—Ü
df = pd.read_parquet('data_downloaded/year=2024/month=12/data_part_12.parquet')

# –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω—É–∂–Ω–æ–π –ø–∞—Ä—ã
btc = df[df['symbol'] == 'BTCUSDT']
btc = btc.drop_duplicates(subset=['timestamp']).sort_values('timestamp')
```

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–∞—Ä—Ç–∏—Ü–∏—è–º (pyarrow):
```python
import pyarrow.dataset as ds

dataset = ds.dataset('data_downloaded', format='parquet', partitioning='hive')
flt = (
    (ds.field('year') == 2024)
    & (ds.field('month') == 12)
    & (ds.field('symbol') == 'BTCUSDT')
)

table = dataset.to_table(columns=['timestamp', 'symbol', 'close'], filter=flt)
```

## üßæ Legacy per-symbol/day (–∞—Ä—Ö–∏–≤)

–≠—Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å —Ä–∞–Ω–µ–µ –∏ –æ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ —É—Å—Ç–∞—Ä–µ–≤—à–∞—è.
–ï—Å–ª–∏ –≤—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ —Å —Ç–∞–∫–∏–º –Ω–∞–±–æ—Ä–æ–º, —Å–º. —Ç–∞–∫–∂–µ `docs/clean_data_structure.md`.

```
data_downloaded/
‚îú‚îÄ‚îÄ SYMBOL/                          # –ù–∞–ø—Ä–∏–º–µ—Ä: BTCUSDT, ETHUSDT
‚îÇ   ‚îî‚îÄ‚îÄ year=YYYY/
‚îÇ       ‚îî‚îÄ‚îÄ month=MM/
‚îÇ           ‚îî‚îÄ‚îÄ day=DD/
‚îÇ               ‚îú‚îÄ‚îÄ hash1.parquet
‚îÇ               ‚îú‚îÄ‚îÄ hash2.parquet
‚îÇ               ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ .symbols_cache.json
```

## üìå –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –î–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –Ω–∞ —É—Ä–æ–≤–Ω–µ parquet (pyarrow/dask).
- –í—Å–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –≤ UTC, –±–∞–∑–æ–≤—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª ‚Äî 15 –º–∏–Ω—É—Ç.
- –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å legacy-—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π —É–¥–∞–ª—è–π—Ç–µ –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ `timestamp` –∏ `symbol`.
